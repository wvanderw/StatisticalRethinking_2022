[["conditional-manatees.html", "Chapter 8 Conditional manatees 8.1 Building an interaction 8.2 Symmetry of interactions", " Chapter 8 Conditional manatees 8.1 Building an interaction \\(R\\) = ruggedness, \\(G\\) = GDP, \\(C\\) = continent, \\(U\\) = unobserved variables. library(dagitty) library(rethinking) ## Loading required package: rstan ## Loading required package: StanHeaders ## Loading required package: ggplot2 ## rstan (Version 2.21.5, GitRev: 2e1f913d3ca3) ## For execution on a local, multicore CPU with excess RAM we recommend calling ## options(mc.cores = parallel::detectCores()). ## To avoid recompilation of unchanged Stan programs, we recommend calling ## rstan_options(auto_write = TRUE) ## Do not specify &#39;-march=native&#39; in &#39;LOCAL_CPPFLAGS&#39; or a Makevars file ## Loading required package: cmdstanr ## This is cmdstanr version 0.5.3 ## - CmdStanR documentation and vignettes: mc-stan.org/cmdstanr ## - Use set_cmdstan_path() to set the path to CmdStan ## - Use install_cmdstan() to install CmdStan ## Loading required package: parallel ## rethinking (Version 2.21) ## ## Attaching package: &#39;rethinking&#39; ## The following object is masked from &#39;package:rstan&#39;: ## ## stan ## The following object is masked from &#39;package:stats&#39;: ## ## rstudent dag_8.1 &lt;- dagitty(&quot;dag{ R -&gt; G C -&gt; G U -&gt; G U -&gt; R }&quot;) coordinates(dag_8.1) &lt;- list(y = c(R = 0, G = 0, C = 0, U = 1), x = c(R = 0, G = 1, U = 1, C = 2)) drawdag(dag_8.1) \\(G = f(R,C)\\) 8.1.1 Making a rugged model library(rethinking) data(rugged) d &lt;- rugged #log transform GDP d$log_gdp &lt;- log(d$rgdppc_2000) #only include countries with GDP data dd &lt;- d[complete.cases(d$rgdppc_2000),] #rescale variables dd$log_gdp_std &lt;- (dd$log_gdp) / mean(dd$log_gdp) # values of 1 is average dd$rugged_std &lt;- (dd$rugged) / max(dd$rugged) # values range from 0 to max ruggedness (1) Basic model \\[\\text{log}(y_{i}) \\sim \\text{Normal}(\\mu_{i}, \\sigma)\\\\ \\mu_{i} = \\alpha + \\beta(r_{i} - \\overline{r})\\\\ \\alpha \\sim \\text{Normal}|(1,1)\\\\ \\beta \\sim \\text{Normal}(0, 1)\\\\ \\sigma \\sim \\text{Exponential}(1)\\] In R: m8.1 &lt;- quap( alist( log_gdp_std ~ dnorm(mu, sigma), mu &lt;- a + b*(rugged_std - 0.215), a ~ dnorm(1, 1), b ~ dnorm(0, 1), sigma ~ dexp(1) ), data = dd ) Sample priors: set.seed(11) prior &lt;- extract.prior(m8.1) #set plot plot(NULL, xlim=c(0,1), ylim=c(0.5, 1.5), xlab = &quot;ruggedness&quot;, ylab = &quot;log GDP&quot;) abline(h=min(dd$log_gdp_std), lty = 2) abline(h=max(dd$log_gdp_std), lty = 2) #draw lines from prior rugged_seq &lt;- seq(from = -0.1, to = 1.1, length.out=30) mu &lt;- link(m8.1, post = prior, data = data.frame(rugged_std=rugged_seq)) for(i in 1:50){ lines(rugged_seq, mu[i,], col=col.alpha(&#39;black&#39;,0.3)) } \\(\\alpha\\) is too wild. intercept should be somewhere around where the mean of ruggedness hits 1 on the log GDP scale so adjust to Normal(1, 0.1). \\(\\beta\\) is also out of control. we need something (positive or negative) that spans the difference between the dashed lines Slope should be \\(\\pm 0.6\\) which is the differece between the maximum and minimum values of GDP max(dd$log_gdp_std) - min(dd$log_gdp_std) ## [1] 0.5658058 #proportion of slopes greater than 0.6 sum(abs(prior$b) &gt; 0.6) / length(prior$b) ## [1] 0.54 Lets fix the model m8.1 &lt;- quap( alist( log_gdp_std ~dnorm(mu,sigma), mu &lt;-a+b*(rugged_std-0.215), a ~dnorm(1,0.1), b ~dnorm(0,0.3), sigma ~dexp(1) ), data = dd ) precis(m8.1) ## mean sd 5.5% 94.5% ## a 0.999998578 0.010412457 0.98335746 1.01663970 ## b 0.001994904 0.054795958 -0.08557962 0.08956943 ## sigma 0.136503830 0.007397023 0.12468196 0.14832570 No association seen yet 8.1.2 Adding an indicator isnt enough Update \\(\\mu\\) \\[\\mu_{i} = \\alpha_{CID[i]} + \\beta(r_{i} - \\overline{r})\\] #make an index variable for Africa (1) and other continents (2) dd$cid &lt;- ifelse(dd$cont_africa == 1, 1, 2) Now update the model m8.2 &lt;- quap( alist( log_gdp_std ~ dnorm(mu, sigma), mu &lt;-a[cid] + b * (rugged_std - 0.215), a[cid] ~ dnorm(1, 0.1), b ~ dnorm(0, 0.3), sigma ~dexp(1) ), data = dd ) compare(m8.1, m8.2) ## WAIC SE dWAIC dSE pWAIC weight ## m8.2 -252.1508 15.25508 0.00000 NA 4.291725 1.000000e+00 ## m8.1 -188.9664 13.28913 63.18439 15.11018 2.574284 1.904075e-14 precis(m8.2, depth = 2) ## mean sd 5.5% 94.5% ## a[1] 0.88040848 0.015938408 0.8549358 0.90588113 ## a[2] 1.04916209 0.010186473 1.0328821 1.06544204 ## b -0.04651791 0.045690786 -0.1195406 0.02650479 ## sigma 0.11239762 0.006092464 0.1026607 0.12213455 post &lt;- extract.samples(m8.2) diff_a1_a2 &lt;- post$a[,1] - post$a[,2] PI(diff_a1_a2) ## 5% 94% ## -0.1988472 -0.1384092 rugged.seq &lt;- seq(from = -0.1, to = 1.1, length.out = 30) mu.NotAfrica &lt;- link(m8.2, data = data.frame(cid=2, rugged_std=rugged.seq)) mu.Africa &lt;- link(m8.2, data = data.frame(cid = 1, rugged_std = rugged.seq)) mu.NotAfrica_mu &lt;- apply(mu.NotAfrica, 2, mean) mu.NotAfrica_ci &lt;- apply(mu.NotAfrica, 2, PI, prob = 0.97) mu.Africa_mu &lt;- apply(mu.Africa, 2, mean) mu.Africa_ci &lt;- apply(mu.Africa, 2, PI) plot(NULL, xlim=c(0,1), ylim=c(0.5, 1.5), xlab = &quot;ruggedness&quot;, ylab = &quot;log GDP&quot;) points(dd$rugged_std, dd$log_gdp_std, col = dd$cid, pch = 16) lines(rugged.seq, mu.Africa_mu, lwd = 2, col = 1) shade(mu.Africa_ci, rugged.seq) lines(rugged.seq, mu.NotAfrica_mu, lwd = 2, col = 2) shade(mu.NotAfrica_ci, rugged.seq, col = col.alpha(2, 0.3)) 8.1.3 Adding an interaction does work \\[\\mu_{i} = \\alpha_{CID[i]} + \\beta_{CID[i]}(r_{i} - \\overline{r})\\] m8.3 &lt;- quap( alist( log_gdp_std ~ dnorm(mu, sigma), mu &lt;-a[cid] + b[cid] * (rugged_std - 0.215), a[cid] ~ dnorm(1, 0.1), b[cid] ~ dnorm(0, 0.3), sigma ~dexp(1) ), data = dd ) precis(m8.3, depth = 2) ## mean sd 5.5% 94.5% ## a[1] 0.8865632 0.015675727 0.86151037 0.91161605 ## a[2] 1.0505709 0.009936627 1.03469025 1.06645155 ## b[1] 0.1325019 0.074204597 0.01390861 0.25109517 ## b[2] -0.1425818 0.054749512 -0.23008206 -0.05508147 ## sigma 0.1094944 0.005935331 0.10000855 0.11898016 compare(m8.1, m8.2, m8.3, func=PSIS) ## Some Pareto k values are high (&gt;0.5). Set pointwise=TRUE to inspect individual points. ## PSIS SE dPSIS dSE pPSIS weight ## m8.3 -258.8749 15.35435 0.000000 NA 5.314384 9.688047e-01 ## m8.2 -252.0033 15.30167 6.871589 6.936621 4.354277 3.119533e-02 ## m8.1 -188.4136 13.40307 70.461243 15.674795 2.856543 4.850334e-16 plot(PSIS(m8.3, pointwise = TRUE)$k) ## Some Pareto k values are high (&gt;0.5). Set pointwise=TRUE to inspect individual points. 8.1.4 Plotting the interaction par(mfrow=c(1,2)) # plot Africa - cid = 1 d.A1 &lt;-dd[dd$cid == 1,] plot(d.A1$rugged_std, d.A1$log_gdp_std, pch=16, col=rangi2, xlab=&quot;ruggedness (standardized)&quot;,ylab=&quot;log GDP (as proportion of mean)&quot;, xlim=c(0,1) ) mu &lt;-link(m8.3,data=data.frame(cid=1,rugged_std=rugged_seq)) mu_mean &lt;-apply(mu,2,mean) mu_ci &lt;-apply(mu,2,PI,prob=0.97) lines( rugged_seq,mu_mean,lwd=2) shade( mu_ci,rugged_seq,col=col.alpha(rangi2,0.3)) mtext(&quot;African nations&quot;) # plotnon-Africa-cid=2 d.A0 &lt;-dd[dd$cid==2,] plot( d.A0$rugged_std,d.A0$log_gdp_std,pch=1,col=&quot;black&quot;, xlab=&quot;ruggedness (standardized)&quot;,ylab=&quot;logGDP(asproportionofmean)&quot;, xlim=c(0,1) ) mu &lt;-link(m8.3,data=data.frame(cid=2,rugged_std=rugged_seq)) mu_mean &lt;-apply(mu,2,mean) mu_ci &lt;-apply(mu,2,PI,prob=0.97) lines( rugged_seq,mu_mean,lwd=2) shade( mu_ci,rugged_seq) mtext(&quot;Non-African nations&quot;) 8.2 Symmetry of interactions You can break an interaction into 2 identical phrasings 1. GDP ~ ruggedness depending on Africa 2. Africa ~ GDP depending on rugedness \\[\\mu_{i} = (2 - CID_{i})(\\alpha_{1} + \\beta_{1}(r_{i} - \\overline{r})) + (CID_{i} - 1)(\\alpha_{2} + \\beta_{2}(r_{i} - \\overline{r}))\\] rugged_seq &lt;- seq(from = -0.2, to = 1.2, length.out = 30) muA &lt;- link(m8.3, data=data.frame(cid=1, rugged_std=rugged_seq)) muN &lt;- link(m8.3, data=data.frame(cid=2, rugged_std=rugged_seq)) delta &lt;- muA - muN mu.delta &lt;- apply(delta, 2, mean) PI.delta &lt;- apply(delta, 2, PI) plot(x=rugged_seq, type = &#39;n&#39;, xlim = c(0,1), ylim = c(-0.3, 0.2), xlab = &#39;ruggedness (std)&#39;, ylab = &#39;expected difference log GDP&#39;) abline(h = 0, lty = 2) text(x = 0.2, y = 0, label = &quot;Africa higher GDP\\nAfrica lower GDP&quot;) lines(rugged_seq, mu.delta) shade(PI.delta, rugged_seq) "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
