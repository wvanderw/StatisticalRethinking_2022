<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 The many variables &amp; the spurious waffles | Rethinking Companion</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 The many variables &amp; the spurious waffles | Rethinking Companion" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 The many variables &amp; the spurious waffles | Rethinking Companion" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Wade VanderWright" />


<meta name="date" content="2022-09-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="geocentric-models.html"/>
<link rel="next" href="the-haunted-dag-the-casual-terror.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Rethinking Companion</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> url: your book url like <span>https://bookdown.org/yihui/bookdown</span></a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#statistical-golems"><i class="fa fa-check"></i><b>1.1</b> Statistical golems</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#statistical-rethinking"><i class="fa fa-check"></i><b>1.2</b> Statistical Rethinking</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#what-are-we-trying-to-do-with-the-golems"><i class="fa fa-check"></i><b>1.2.1</b> What are we trying to do with the golems?</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#tools-for-golem-engineering"><i class="fa fa-check"></i><b>1.3</b> Tools for golem engineering</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#bayesian-data-analysis"><i class="fa fa-check"></i><b>1.3.1</b> Bayesian data analysis</a></li>
<li class="chapter" data-level="1.3.2" data-path="index.html"><a href="index.html#model-comparison-and-predictions"><i class="fa fa-check"></i><b>1.3.2</b> Model comparison and predictions</a></li>
<li class="chapter" data-level="1.3.3" data-path="index.html"><a href="index.html#multilevel-models"><i class="fa fa-check"></i><b>1.3.3</b> Multilevel models</a></li>
<li class="chapter" data-level="1.3.4" data-path="index.html"><a href="index.html#graphical-causal-models"><i class="fa fa-check"></i><b>1.3.4</b> Graphical causal models</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#summary"><i class="fa fa-check"></i><b>1.4</b> Summary</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Small worlds and large worlds</a>
<ul>
<li class="chapter" data-level="2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#the-garden-of-forking-data"><i class="fa fa-check"></i><b>2.1</b> The garden of forking data</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#counting-possibilities"><i class="fa fa-check"></i><b>2.1.1</b> Counting possibilities</a></li>
<li class="chapter" data-level="2.1.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#combining-other-information"><i class="fa fa-check"></i><b>2.1.2</b> Combining other information</a></li>
<li class="chapter" data-level="2.1.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#from-counts-to-probability"><i class="fa fa-check"></i><b>2.1.3</b> From counts to probability</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#building-a-model"><i class="fa fa-check"></i><b>2.2</b> Building a model</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-data-story"><i class="fa fa-check"></i><b>2.2.1</b> A data story</a></li>
<li class="chapter" data-level="2.2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayesian-updating"><i class="fa fa-check"></i><b>2.2.2</b> Bayesian updating</a></li>
<li class="chapter" data-level="2.2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#evaluate"><i class="fa fa-check"></i><b>2.2.3</b> Evaluate</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#components-of-the-model"><i class="fa fa-check"></i><b>2.3</b> Components of the model</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#variables"><i class="fa fa-check"></i><b>2.3.1</b> Variables</a></li>
<li class="chapter" data-level="2.3.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#definitions"><i class="fa fa-check"></i><b>2.3.2</b> Definitions</a></li>
<li class="chapter" data-level="2.3.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-model-is-born"><i class="fa fa-check"></i><b>2.3.3</b> A model is born</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#maiking-the-model-go"><i class="fa fa-check"></i><b>2.4</b> Maiking the model go</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic"><i class="fa fa-check"></i><b>2.4.1</b> Quadratic</a></li>
<li class="chapter" data-level="2.4.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#mcmc"><i class="fa fa-check"></i><b>2.4.2</b> MCMC</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#select-practice-questions"><i class="fa fa-check"></i><b>2.5</b> Select practice questions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the imaginary</a>
<ul>
<li class="chapter" data-level="3.0.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#probabilities-vs.-frequency-counts"><i class="fa fa-check"></i><b>3.0.1</b> Probabilities vs. Frequency counts</a></li>
<li class="chapter" data-level="3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-approximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-boundaries"><i class="fa fa-check"></i><b>3.2.1</b> Intervals of defined boundaries</a></li>
<li class="chapter" data-level="3.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass"><i class="fa fa-check"></i><b>3.2.2</b> intervals of defined mass</a></li>
<li class="chapter" data-level="3.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimates"><i class="fa fa-check"></i><b>3.2.3</b> Point estimates</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#dummy-data"><i class="fa fa-check"></i><b>3.3.1</b> Dummy data</a></li>
<li class="chapter" data-level="3.3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking"><i class="fa fa-check"></i><b>3.3.2</b> Model checking</a></li>
<li class="chapter" data-level="3.3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#practice-with-brms"><i class="fa fa-check"></i><b>3.3.3</b> Practice with brms</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric-models.html"><a href="geocentric-models.html"><i class="fa fa-check"></i><b>4</b> Geocentric models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why normal distributions are normal</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-addition"><i class="fa fa-check"></i><b>4.1.1</b> Normal by addition</a></li>
<li class="chapter" data-level="4.1.2" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-multiplication"><i class="fa fa-check"></i><b>4.1.2</b> Normal by multiplication</a></li>
<li class="chapter" data-level="4.1.3" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-log-multiplication"><i class="fa fa-check"></i><b>4.1.3</b> Normal by log-multiplication</a></li>
<li class="chapter" data-level="4.1.4" data-path="geocentric-models.html"><a href="geocentric-models.html#using-gaussian-distributions"><i class="fa fa-check"></i><b>4.1.4</b> Using Gaussian distributions</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>4.2</b> A language for describing models</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="geocentric-models.html"><a href="geocentric-models.html#re-describing-the-globe-tossing-model."><i class="fa fa-check"></i><b>4.2.1</b> Re-describing the globe tossing model.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> Gaussian model of height</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-data"><i class="fa fa-check"></i><b>4.3.1</b> The data</a></li>
<li class="chapter" data-level="4.3.2" data-path="geocentric-models.html"><a href="geocentric-models.html#the-model"><i class="fa fa-check"></i><b>4.3.2</b> The Model</a></li>
<li class="chapter" data-level="4.3.3" data-path="geocentric-models.html"><a href="geocentric-models.html#grid-approximation-of-the-posterior-distribution"><i class="fa fa-check"></i><b>4.3.3</b> Grid approximation of the posterior distribution</a></li>
<li class="chapter" data-level="4.3.4" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-the-posterior"><i class="fa fa-check"></i><b>4.3.4</b> Sampling from the posterior</a></li>
<li class="chapter" data-level="4.3.5" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution-with-quap"><i class="fa fa-check"></i><b>4.3.5</b> Finding the posterior distribution with <code>quap</code></a></li>
<li class="chapter" data-level="4.3.6" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-with-quap"><i class="fa fa-check"></i><b>4.3.6</b> Sampling with <code>quap</code></a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="geocentric-models.html"><a href="geocentric-models.html#linear-prediction"><i class="fa fa-check"></i><b>4.4</b> Linear Prediction</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribtuion"><i class="fa fa-check"></i><b>4.4.1</b> Finding the posterior distribtuion</a></li>
<li class="chapter" data-level="4.4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#interpreting-the-posterior-distribution"><i class="fa fa-check"></i><b>4.4.2</b> Interpreting the posterior distribution</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geocentric-models.html"><a href="geocentric-models.html#curves-from-lines"><i class="fa fa-check"></i><b>4.5</b> Curves from lines</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="geocentric-models.html"><a href="geocentric-models.html#polynomial-regression"><i class="fa fa-check"></i><b>4.5.1</b> Polynomial regression</a></li>
<li class="chapter" data-level="4.5.2" data-path="geocentric-models.html"><a href="geocentric-models.html#splines"><i class="fa fa-check"></i><b>4.5.2</b> Splines</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html"><i class="fa fa-check"></i><b>5</b> The many variables &amp; the spurious waffles</a>
<ul>
<li class="chapter" data-level="5.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#spurious-assoiciation"><i class="fa fa-check"></i><b>5.1</b> Spurious assoiciation</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#think-before-to-regress"><i class="fa fa-check"></i><b>5.1.1</b> Think before to regress</a></li>
<li class="chapter" data-level="5.1.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#testable-implications"><i class="fa fa-check"></i><b>5.1.2</b> Testable implications</a></li>
<li class="chapter" data-level="5.1.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#multiple-regression-notation"><i class="fa fa-check"></i><b>5.1.3</b> Multiple regression notation</a></li>
<li class="chapter" data-level="5.1.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#approximating-the-posterior"><i class="fa fa-check"></i><b>5.1.4</b> Approximating the posterior</a></li>
<li class="chapter" data-level="5.1.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#plotting-multivariate-posteriors"><i class="fa fa-check"></i><b>5.1.5</b> Plotting multivariate posteriors</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#masked-relationship"><i class="fa fa-check"></i><b>5.2</b> Masked relationship</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="the-haunted-dag-the-casual-terror.html"><a href="the-haunted-dag-the-casual-terror.html"><i class="fa fa-check"></i><b>6</b> The haunted dag &amp; the casual terror</a>
<ul>
<li class="chapter" data-level="6.1" data-path="the-haunted-dag-the-casual-terror.html"><a href="the-haunted-dag-the-casual-terror.html#equations"><i class="fa fa-check"></i><b>6.1</b> Equations</a></li>
<li class="chapter" data-level="6.2" data-path="the-haunted-dag-the-casual-terror.html"><a href="the-haunted-dag-the-casual-terror.html#theorems-and-proofs"><i class="fa fa-check"></i><b>6.2</b> Theorems and proofs</a></li>
<li class="chapter" data-level="6.3" data-path="the-haunted-dag-the-casual-terror.html"><a href="the-haunted-dag-the-casual-terror.html#callout-blocks"><i class="fa fa-check"></i><b>6.3</b> Callout blocks</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ulysses-compass.html"><a href="ulysses-compass.html"><i class="fa fa-check"></i><b>7</b> Ulysses’ compass</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#publishing"><i class="fa fa-check"></i><b>7.1</b> Publishing</a></li>
<li class="chapter" data-level="7.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#pages"><i class="fa fa-check"></i><b>7.2</b> 404 pages</a></li>
<li class="chapter" data-level="7.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#metadata-for-sharing"><i class="fa fa-check"></i><b>7.3</b> Metadata for sharing</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditional-manatees.html"><a href="conditional-manatees.html"><i class="fa fa-check"></i><b>8</b> Conditional manatees</a></li>
<li class="chapter" data-level="9" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>9</b> Markov chain monte carlo</a></li>
<li class="chapter" data-level="10" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>10</b> Big entropy and the generalized linear model</a></li>
<li class="chapter" data-level="11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html"><i class="fa fa-check"></i><b>11</b> God spiked the integers</a></li>
<li class="chapter" data-level="12" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html"><i class="fa fa-check"></i><b>12</b> Monsters and mixtures</a></li>
<li class="chapter" data-level="13" data-path="models-with-memory.html"><a href="models-with-memory.html"><i class="fa fa-check"></i><b>13</b> Models with memory</a></li>
<li class="chapter" data-level="14" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html"><i class="fa fa-check"></i><b>14</b> Adventures in covariance</a></li>
<li class="chapter" data-level="15" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html"><i class="fa fa-check"></i><b>15</b> Missing data and other opportunities</a></li>
<li class="chapter" data-level="16" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html"><i class="fa fa-check"></i><b>16</b> Generalized linear madness</a></li>
<li class="chapter" data-level="17" data-path="horoscopes.html"><a href="horoscopes.html"><i class="fa fa-check"></i><b>17</b> Horoscopes</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Rethinking Companion</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-many-variables-the-spurious-waffles" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> The many variables &amp; the spurious waffles<a href="the-many-variables-the-spurious-waffles.html#the-many-variables-the-spurious-waffles" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Here is why we need <em>Multiple Regression</em> to model outcomes.<br />
</p>
<ol style="list-style-type: decimal">
<li>Statistical control for confounds<br />
</li>
<li>Multiple and complex causation<br />
</li>
<li>Interactions<br />
</li>
</ol>
<div id="spurious-assoiciation" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Spurious assoiciation<a href="the-many-variables-the-spurious-waffles.html#spurious-assoiciation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Divorce rate seems to be positively correlated with marriage rate. But does higher marriage rate cause a higher divorce rate?</p>
<p>Divorce rate is also negatively correlated with median age at marriage meaning higher divorce rates for younger couples. But does young marriage are cause more divorce? Let’s find out</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="the-many-variables-the-spurious-waffles.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span></code></pre></div>
<pre><code>## Loading required package: rstan</code></pre>
<pre><code>## Loading required package: StanHeaders</code></pre>
<pre><code>## Loading required package: ggplot2</code></pre>
<pre><code>## rstan (Version 2.21.5, GitRev: 2e1f913d3ca3)</code></pre>
<pre><code>## For execution on a local, multicore CPU with excess RAM we recommend calling
## options(mc.cores = parallel::detectCores()).
## To avoid recompilation of unchanged Stan programs, we recommend calling
## rstan_options(auto_write = TRUE)</code></pre>
<pre><code>## Do not specify &#39;-march=native&#39; in &#39;LOCAL_CPPFLAGS&#39; or a Makevars file</code></pre>
<pre><code>## Loading required package: cmdstanr</code></pre>
<pre><code>## This is cmdstanr version 0.5.3</code></pre>
<pre><code>## - CmdStanR documentation and vignettes: mc-stan.org/cmdstanr</code></pre>
<pre><code>## - Use set_cmdstan_path() to set the path to CmdStan</code></pre>
<pre><code>## - Use install_cmdstan() to install CmdStan</code></pre>
<pre><code>## Loading required package: parallel</code></pre>
<pre><code>## rethinking (Version 2.21)</code></pre>
<pre><code>## 
## Attaching package: &#39;rethinking&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:rstan&#39;:
## 
##     stan</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     rstudent</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="the-many-variables-the-spurious-waffles.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(WaffleDivorce)</span>
<span id="cb18-2"><a href="the-many-variables-the-spurious-waffles.html#cb18-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> WaffleDivorce</span>
<span id="cb18-3"><a href="the-many-variables-the-spurious-waffles.html#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="the-many-variables-the-spurious-waffles.html#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">#standardize variables</span></span>
<span id="cb18-5"><a href="the-many-variables-the-spurious-waffles.html#cb18-5" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>D <span class="ot">&lt;-</span> <span class="fu">standardize</span>(d<span class="sc">$</span>Divorce)</span>
<span id="cb18-6"><a href="the-many-variables-the-spurious-waffles.html#cb18-6" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>M <span class="ot">&lt;-</span> <span class="fu">standardize</span>(d<span class="sc">$</span>Marriage)</span>
<span id="cb18-7"><a href="the-many-variables-the-spurious-waffles.html#cb18-7" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>A <span class="ot">&lt;-</span> <span class="fu">standardize</span>(d<span class="sc">$</span>MedianAgeMarriage)</span></code></pre></div>
<p>Now we can use some linear modeling skills to see how median age of marriage is related to divorce rates<br />
</p>
<p><span class="math display">\[\begin{equation}
D_{i} \sim \text{Normal}(\mu_{i}, \sigma)\
\mu_{i} = \alpha + \beta_{A}A_{i}\
\alpha \sim \text{Normal}(0, 0.2)\
\beta_{A} \sim \text{Normal}(0, 0.5)\
\sigma \sim \text{Exponential}(1)\
\end{equation}\]</span><em>{i} = + </em>{A}A_{i}<br />
(0, 0.2)<br />
_{A} (0, 0.5)<br />
(1)<br />
\end{equation}</p>
<p>Here <span class="math inline">\(D_{i}\)</span> is the divorce rate in state <span class="math inline">\({i}\)</span> and <span class="math inline">\(A_{i}\)</span> is the median age of marriage in state <span class="math inline">\(i\)</span>. Since both the outcome and predictor are standardized in the above code, the intercept estimate (<span class="math inline">\(\alpha\)</span>) should be somewhere near 0. But how do we interpret the slope <span class="math inline">\(\beta_{A}\)</span>? Well if it were to be estimated as 1, then one sd increase in median age of marriage would be a 1 sd increase in divorce rate. To know the magnitude of a 1 sd change, you would have to calculate it</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="the-many-variables-the-spurious-waffles.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(d<span class="sc">$</span>MedianAgeMarriage)</span></code></pre></div>
<pre><code>## [1] 1.24363</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="the-many-variables-the-spurious-waffles.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(d<span class="sc">$</span>Divorce)</span></code></pre></div>
<pre><code>## [1] 1.820814</code></pre>
<p>So if <span class="math inline">\(\beta_{A}\)</span> was estimated to be 1, an increase of 1.2 years in median age would increase divorce by 1.82 (units?)</p>
<p>Let’s get the posterior of this model</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="the-many-variables-the-spurious-waffles.html#cb23-1" aria-hidden="true" tabindex="-1"></a>m5<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb23-2"><a href="the-many-variables-the-spurious-waffles.html#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb23-3"><a href="the-many-variables-the-spurious-waffles.html#cb23-3" aria-hidden="true" tabindex="-1"></a>    D <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb23-4"><a href="the-many-variables-the-spurious-waffles.html#cb23-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> bA <span class="sc">*</span> A, </span>
<span id="cb23-5"><a href="the-many-variables-the-spurious-waffles.html#cb23-5" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb23-6"><a href="the-many-variables-the-spurious-waffles.html#cb23-6" aria-hidden="true" tabindex="-1"></a>    bA <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb23-7"><a href="the-many-variables-the-spurious-waffles.html#cb23-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb23-8"><a href="the-many-variables-the-spurious-waffles.html#cb23-8" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> d</span>
<span id="cb23-9"><a href="the-many-variables-the-spurious-waffles.html#cb23-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Here is the simulated priors over 2 standard deviations</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="the-many-variables-the-spurious-waffles.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb24-2"><a href="the-many-variables-the-spurious-waffles.html#cb24-2" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">extract.prior</span>(m5<span class="fl">.1</span>)</span>
<span id="cb24-3"><a href="the-many-variables-the-spurious-waffles.html#cb24-3" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">link</span>(m5<span class="fl">.1</span>, <span class="at">post =</span> prior, <span class="at">data =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>)))</span>
<span id="cb24-4"><a href="the-many-variables-the-spurious-waffles.html#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>), <span class="at">xlab =</span> <span class="st">&#39;Median age Marriage (std)&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;Divorce rate (std)&#39;</span>)</span>
<span id="cb24-5"><a href="the-many-variables-the-spurious-waffles.html#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>){</span>
<span id="cb24-6"><a href="the-many-variables-the-spurious-waffles.html#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>), mu[i,], <span class="at">col =</span> <span class="fu">col.alpha</span>(<span class="st">&#39;black&#39;</span>,<span class="fl">0.4</span>))</span>
<span id="cb24-7"><a href="the-many-variables-the-spurious-waffles.html#cb24-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="_main_files/figure-html/Rcode%205.4-1.png" width="672" /></p>
<p>Now the posterior</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="the-many-variables-the-spurious-waffles.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate percentiles</span></span>
<span id="cb25-2"><a href="the-many-variables-the-spurious-waffles.html#cb25-2" aria-hidden="true" tabindex="-1"></a>A_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">to =</span> <span class="fl">3.2</span>, <span class="at">length.out =</span> <span class="dv">30</span>)</span>
<span id="cb25-3"><a href="the-many-variables-the-spurious-waffles.html#cb25-3" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">link</span>(m5<span class="fl">.1</span>, <span class="at">data =</span> <span class="fu">list</span>(<span class="at">A =</span> A_seq))</span>
<span id="cb25-4"><a href="the-many-variables-the-spurious-waffles.html#cb25-4" aria-hidden="true" tabindex="-1"></a>mu.mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, mean)</span>
<span id="cb25-5"><a href="the-many-variables-the-spurious-waffles.html#cb25-5" aria-hidden="true" tabindex="-1"></a>mu.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, PI)</span>
<span id="cb25-6"><a href="the-many-variables-the-spurious-waffles.html#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="the-many-variables-the-spurious-waffles.html#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">#plot</span></span>
<span id="cb25-8"><a href="the-many-variables-the-spurious-waffles.html#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(D <span class="sc">~</span> A, <span class="at">data =</span> d, <span class="at">col =</span> rangi2, <span class="at">xlab =</span> <span class="st">&#39;Median age Marriage (std)&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;Divorce rate (std)&#39;</span>)</span>
<span id="cb25-9"><a href="the-many-variables-the-spurious-waffles.html#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(A_seq, mu.mean, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb25-10"><a href="the-many-variables-the-spurious-waffles.html#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="fu">shade</span>(mu.PI, A_seq)</span></code></pre></div>
<p><img src="_main_files/figure-html/Rcode%205.5-1.png" width="672" /></p>
<p>And now the Marriage rate model</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="the-many-variables-the-spurious-waffles.html#cb26-1" aria-hidden="true" tabindex="-1"></a>m5<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb26-2"><a href="the-many-variables-the-spurious-waffles.html#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb26-3"><a href="the-many-variables-the-spurious-waffles.html#cb26-3" aria-hidden="true" tabindex="-1"></a>    D <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb26-4"><a href="the-many-variables-the-spurious-waffles.html#cb26-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> bM <span class="sc">*</span> M,</span>
<span id="cb26-5"><a href="the-many-variables-the-spurious-waffles.html#cb26-5" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb26-6"><a href="the-many-variables-the-spurious-waffles.html#cb26-6" aria-hidden="true" tabindex="-1"></a>    bM <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb26-7"><a href="the-many-variables-the-spurious-waffles.html#cb26-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb26-8"><a href="the-many-variables-the-spurious-waffles.html#cb26-8" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> d</span>
<span id="cb26-9"><a href="the-many-variables-the-spurious-waffles.html#cb26-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-10"><a href="the-many-variables-the-spurious-waffles.html#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="the-many-variables-the-spurious-waffles.html#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate percentiles</span></span>
<span id="cb26-12"><a href="the-many-variables-the-spurious-waffles.html#cb26-12" aria-hidden="true" tabindex="-1"></a>M_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="fl">2.8</span>, <span class="at">length.out =</span> <span class="dv">30</span>)</span>
<span id="cb26-13"><a href="the-many-variables-the-spurious-waffles.html#cb26-13" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">link</span>(m5<span class="fl">.2</span>, <span class="at">data =</span> <span class="fu">list</span>(<span class="at">M =</span> M_seq))</span>
<span id="cb26-14"><a href="the-many-variables-the-spurious-waffles.html#cb26-14" aria-hidden="true" tabindex="-1"></a>mu.mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, mean)</span>
<span id="cb26-15"><a href="the-many-variables-the-spurious-waffles.html#cb26-15" aria-hidden="true" tabindex="-1"></a>mu.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, PI)</span>
<span id="cb26-16"><a href="the-many-variables-the-spurious-waffles.html#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="the-many-variables-the-spurious-waffles.html#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="co">#plot</span></span>
<span id="cb26-18"><a href="the-many-variables-the-spurious-waffles.html#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(D <span class="sc">~</span> M, <span class="at">data =</span> d, <span class="at">col =</span> rangi2, <span class="at">xlab =</span> <span class="st">&#39;Marriage rate (std)&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;Divorce rate (std)&#39;</span>)</span>
<span id="cb26-19"><a href="the-many-variables-the-spurious-waffles.html#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(M_seq, mu.mean, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb26-20"><a href="the-many-variables-the-spurious-waffles.html#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="fu">shade</span>(mu.PI, M_seq)</span></code></pre></div>
<p><img src="_main_files/figure-html/Rcode%205.6-1.png" width="672" /></p>
<p>Comparing these two models won’t yield much useful information. We need to think about how they may interact together on Divorce rates</p>
<div id="think-before-to-regress" class="section level3 hasAnchor" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> Think before to regress<a href="the-many-variables-the-spurious-waffles.html#think-before-to-regress" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We have to try and think about causal inference before we start fitting models. The best way is to create a <strong>DAG</strong> or <em>Directed Acyclic Graph</em>. In these graphs we can add direction of influence between variables of interest. From the graphs above, we know that both <span class="math inline">\(A\)</span> and <span class="math inline">\(M\)</span> influence our outcome variable <span class="math inline">\(D\)</span>. But, is there any relationship between <span class="math inline">\(A\)</span> and <span class="math inline">\(M\)</span>? Also note that to make these graphs, assumptions have to be made in order to make inference.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="the-many-variables-the-spurious-waffles.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dagitty)</span>
<span id="cb27-2"><a href="the-many-variables-the-spurious-waffles.html#cb27-2" aria-hidden="true" tabindex="-1"></a>dag5<span class="fl">.1</span> <span class="ot">&lt;-</span><span class="fu">dagitty</span>(<span class="st">&quot;dag{A-&gt;D;A-&gt;M;M-&gt;D}&quot;</span>)</span>
<span id="cb27-3"><a href="the-many-variables-the-spurious-waffles.html#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(dag5<span class="fl">.1</span>) <span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="at">A=</span><span class="dv">0</span>,<span class="at">D=</span><span class="dv">1</span>,<span class="at">M=</span><span class="dv">2</span>),<span class="at">y=</span><span class="fu">c</span>(<span class="at">A=</span><span class="dv">0</span>,<span class="at">D=</span><span class="dv">1</span>,<span class="at">M=</span><span class="dv">0</span>))</span>
<span id="cb27-4"><a href="the-many-variables-the-spurious-waffles.html#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">drawdag</span>( dag5<span class="fl">.1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/Rcode%205.7-1.png" width="672" /></p>
<p>What this <em>DAG</em> says is:<br />
1. <span class="math inline">\(A\)</span> directly influences <span class="math inline">\(D\)</span><br />
2. <span class="math inline">\(M\)</span> directly influences <span class="math inline">\(D\)</span><br />
3. <span class="math inline">\(A\)</span> directly influences <span class="math inline">\(M\)</span><br />
</p>
<p>So there are two pathways from <span class="math inline">\(A\)</span> to <span class="math inline">\(D\)</span>. One is the direct effect of <span class="math inline">\(A\)</span> on <span class="math inline">\(D\)</span>, and the other is an indirect effect of <span class="math inline">\(A\)</span> <span class="math inline">\(\rightarrow\)</span> <span class="math inline">\(M\)</span> <span class="math inline">\(\rightarrow\)</span> <span class="math inline">\(D\)</span>. We saw that there is a strong negative association of <span class="math inline">\(A\)</span> and <span class="math inline">\(D\)</span> above in model <code>m5.1</code> but we don’t know if that association is direct or entirely working through an indirect pathway. Alternatively, the effect of <span class="math inline">\(M\)</span> on <span class="math inline">\(D\)</span> could be entirely from <span class="math inline">\(A\)</span>’s effect on <span class="math inline">\(M\)</span> like this:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="the-many-variables-the-spurious-waffles.html#cb28-1" aria-hidden="true" tabindex="-1"></a>dag5<span class="fl">.2</span> <span class="ot">&lt;-</span><span class="fu">dagitty</span>(<span class="st">&quot;dag{A-&gt;D;A-&gt;M}&quot;</span>)</span>
<span id="cb28-2"><a href="the-many-variables-the-spurious-waffles.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(dag5<span class="fl">.2</span>) <span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="at">A=</span><span class="dv">0</span>,<span class="at">D=</span><span class="dv">1</span>,<span class="at">M=</span><span class="dv">2</span>),<span class="at">y=</span><span class="fu">c</span>(<span class="at">A=</span><span class="dv">0</span>,<span class="at">D=</span><span class="dv">1</span>,<span class="at">M=</span><span class="dv">0</span>))</span>
<span id="cb28-3"><a href="the-many-variables-the-spurious-waffles.html#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">drawdag</span>( dag5<span class="fl">.2</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
</div>
<div id="testable-implications" class="section level3 hasAnchor" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> Testable implications<a href="the-many-variables-the-spurious-waffles.html#testable-implications" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now we have two different <strong>DAGs</strong> that we can consider their testable implications or conditional independencies. The first <strong>DAG</strong> with three arrows has every pair of variables connected by arrows. We can test this by checking their correlations with each other.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="the-many-variables-the-spurious-waffles.html#cb29-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(d<span class="sc">$</span>D, d<span class="sc">$</span>A)</span></code></pre></div>
<pre><code>## [1] -0.5972392</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="the-many-variables-the-spurious-waffles.html#cb31-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(d<span class="sc">$</span>D, d<span class="sc">$</span>M)</span></code></pre></div>
<pre><code>## [1] 0.3737314</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="the-many-variables-the-spurious-waffles.html#cb33-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(d<span class="sc">$</span>A, d<span class="sc">$</span>M)</span></code></pre></div>
<pre><code>## [1] -0.721096</code></pre>
<p>Pretty strong associations all around. In the second <strong>DAG</strong> the implication is that <span class="math inline">\(D\)</span> could be independent of <span class="math inline">\(M\)</span> without <span class="math inline">\(A\)</span>. Or written in mathy language <span class="math inline">\(D \perp\!\!\!\perp M|A\)</span> which means that <span class="math inline">\(D\)</span> is independent of <span class="math inline">\(M\)</span> conditioned on <span class="math inline">\(A\)</span>. We can look for conditional independencies with the <code>dagitty</code> package.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="the-many-variables-the-spurious-waffles.html#cb35-1" aria-hidden="true" tabindex="-1"></a>DMA_dag2 <span class="ot">&lt;-</span> <span class="fu">dagitty</span>(<span class="st">&#39;dag{D &lt;- A -&gt; M}&#39;</span>)</span>
<span id="cb35-2"><a href="the-many-variables-the-spurious-waffles.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">impliedConditionalIndependencies</span>(DMA_dag2)</span></code></pre></div>
<pre><code>## D _||_ M | A</code></pre>
<p>If we run this on the first three arrow <strong>DAG</strong> we won’t see an output because there are no conditional independencies in that particular model.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="the-many-variables-the-spurious-waffles.html#cb37-1" aria-hidden="true" tabindex="-1"></a>DMA_dag1 <span class="ot">&lt;-</span> <span class="fu">dagitty</span>(<span class="st">&#39;dag{D &lt;- A -&gt; M -&gt; D}&#39;</span>)</span>
<span id="cb37-2"><a href="the-many-variables-the-spurious-waffles.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">impliedConditionalIndependencies</span>(DMA_dag1)</span></code></pre></div>
<p>Because <span class="math inline">\(D \perp\!\!\!\perp M|A\)</span> is the only implication that differs between the models, we need a model that will condition on <span class="math inline">\(A\)</span>. In other words, once we have conditioned for <span class="math inline">\(A\)</span> (accounted for <span class="math inline">\(A\)</span>), does knowing <span class="math inline">\(M\)</span> add any additional information about <span class="math inline">\(D\)</span>? The expectation from the <strong>DAG</strong> is that <em>no there shouldn’t be</em>.</p>
<p>Once we fit a mutiple regression using all 3 variables we will be able to address how much knowing <span class="math inline">\(M\)</span> influences <span class="math inline">\(D\)</span> and also how much knowing <span class="math inline">\(A\)</span> influences <span class="math inline">\(D\)</span>.</p>
</div>
<div id="multiple-regression-notation" class="section level3 hasAnchor" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> Multiple regression notation<a href="the-many-variables-the-spurious-waffles.html#multiple-regression-notation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>These will look a lot like the polynomial regressions of the last chapter.<br />
</p>
<p><span class="math display">\[\begin{equation}
D_{i} \sim \text{Normal}(\mu_{i}, \sigma)\
\mu_{i} = \alpha + \beta_{M}M_{i} + \beta_{A}A_{i}\
\alpha \sim \text{Normal}(0, 0.2)\
\beta_{M} \sim \text{Normal}(0, 0.5)\
\beta_{A} \sim \text{Normal}(0, 0.5)\
\sigma \sim \text{Exponential}(1)\
\end{equation}\]</span><em>{i} = + </em>{M}M_{i} + <em>{A}A</em>{i}<br />
(0, 0.2)<br />
<em>{M} (0, 0.5)<br />
</em>{A} (0, 0.5)<br />
(1)<br />
\end{equation}</p>
</div>
<div id="approximating-the-posterior" class="section level3 hasAnchor" number="5.1.4">
<h3><span class="header-section-number">5.1.4</span> Approximating the posterior<a href="the-many-variables-the-spurious-waffles.html#approximating-the-posterior" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Like models before now, we will use the <code>quap</code> function to approximate the posterior</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="the-many-variables-the-spurious-waffles.html#cb38-1" aria-hidden="true" tabindex="-1"></a>m5<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb38-2"><a href="the-many-variables-the-spurious-waffles.html#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb38-3"><a href="the-many-variables-the-spurious-waffles.html#cb38-3" aria-hidden="true" tabindex="-1"></a>    D <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb38-4"><a href="the-many-variables-the-spurious-waffles.html#cb38-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> bM <span class="sc">*</span> M <span class="sc">+</span> bA <span class="sc">*</span> A,</span>
<span id="cb38-5"><a href="the-many-variables-the-spurious-waffles.html#cb38-5" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb38-6"><a href="the-many-variables-the-spurious-waffles.html#cb38-6" aria-hidden="true" tabindex="-1"></a>    bM <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb38-7"><a href="the-many-variables-the-spurious-waffles.html#cb38-7" aria-hidden="true" tabindex="-1"></a>    bA <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb38-8"><a href="the-many-variables-the-spurious-waffles.html#cb38-8" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb38-9"><a href="the-many-variables-the-spurious-waffles.html#cb38-9" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> d</span>
<span id="cb38-10"><a href="the-many-variables-the-spurious-waffles.html#cb38-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-11"><a href="the-many-variables-the-spurious-waffles.html#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="the-many-variables-the-spurious-waffles.html#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m5<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>##                mean         sd       5.5%      94.5%
## a     -9.233966e-08 0.09707600 -0.1551463  0.1551461
## bM    -6.538071e-02 0.15077301 -0.3063451  0.1755837
## bA    -6.135136e-01 0.15098354 -0.8548145 -0.3722128
## sigma  7.851177e-01 0.07784332  0.6607090  0.9095263</code></pre>
<p>Let’s see how the slopes have changed in each model</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="the-many-variables-the-spurious-waffles.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">coeftab</span>(m5<span class="fl">.1</span>, m5<span class="fl">.2</span>, m5<span class="fl">.3</span>), <span class="at">par =</span> <span class="fu">c</span>(<span class="st">&#39;bA&#39;</span>,<span class="st">&#39;bM&#39;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/Rcode%205.11-1.png" width="672" /></p>
<p>Here we see that the estimate for <span class="math inline">\(\beta_{A}\)</span> is relatively the same between models where the estimate for <span class="math inline">\(\beta_{M}\)</span> is much closer to 0 when considered with <span class="math inline">\(\beta_{A}\)</span>. This suggests that once <span class="math inline">\(A\)</span> is in the model, adding <span class="math inline">\(M\)</span> doesn’t add much more information. This is congruent with our second <strong>DAG</strong> and tells us that the first <strong>DAG</strong> is not causally correct because <span class="math inline">\(M\)</span> no longer has a direct effect on <span class="math inline">\(D\)</span> once <span class="math inline">\(A\)</span> is in the model.</p>
<p>In case you are curious how <span class="math inline">\(A\)</span> and <span class="math inline">\(M\)</span> are related:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="the-many-variables-the-spurious-waffles.html#cb41-1" aria-hidden="true" tabindex="-1"></a>m5<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb41-2"><a href="the-many-variables-the-spurious-waffles.html#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb41-3"><a href="the-many-variables-the-spurious-waffles.html#cb41-3" aria-hidden="true" tabindex="-1"></a>    M <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb41-4"><a href="the-many-variables-the-spurious-waffles.html#cb41-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> bAM <span class="sc">*</span> A,</span>
<span id="cb41-5"><a href="the-many-variables-the-spurious-waffles.html#cb41-5" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb41-6"><a href="the-many-variables-the-spurious-waffles.html#cb41-6" aria-hidden="true" tabindex="-1"></a>    bAM <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb41-7"><a href="the-many-variables-the-spurious-waffles.html#cb41-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb41-8"><a href="the-many-variables-the-spurious-waffles.html#cb41-8" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> d</span>
<span id="cb41-9"><a href="the-many-variables-the-spurious-waffles.html#cb41-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-10"><a href="the-many-variables-the-spurious-waffles.html#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="the-many-variables-the-spurious-waffles.html#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate percentiles</span></span>
<span id="cb41-12"><a href="the-many-variables-the-spurious-waffles.html#cb41-12" aria-hidden="true" tabindex="-1"></a>A_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fl">2.5</span>, <span class="at">to =</span> <span class="fl">3.2</span>, <span class="at">length.out =</span> <span class="dv">30</span>)</span>
<span id="cb41-13"><a href="the-many-variables-the-spurious-waffles.html#cb41-13" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">link</span>(m5<span class="fl">.4</span>, <span class="at">data =</span> <span class="fu">list</span>(<span class="at">A =</span> A_seq))</span>
<span id="cb41-14"><a href="the-many-variables-the-spurious-waffles.html#cb41-14" aria-hidden="true" tabindex="-1"></a>mu.mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, mean)</span>
<span id="cb41-15"><a href="the-many-variables-the-spurious-waffles.html#cb41-15" aria-hidden="true" tabindex="-1"></a>mu.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, PI)</span>
<span id="cb41-16"><a href="the-many-variables-the-spurious-waffles.html#cb41-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-17"><a href="the-many-variables-the-spurious-waffles.html#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="co">#plot</span></span>
<span id="cb41-18"><a href="the-many-variables-the-spurious-waffles.html#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(M <span class="sc">~</span> A, <span class="at">data =</span> d, <span class="at">col =</span> rangi2, <span class="at">xlab =</span> <span class="st">&#39;Median age of marriage (std)&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;Marriage rate (std)&#39;</span>)</span>
<span id="cb41-19"><a href="the-many-variables-the-spurious-waffles.html#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(A_seq, mu.mean, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb41-20"><a href="the-many-variables-the-spurious-waffles.html#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="fu">shade</span>(mu.PI, A_seq)</span></code></pre></div>
<p><img src="_main_files/figure-html/Rcode%205.13-1.png" width="672" /></p>
</div>
<div id="plotting-multivariate-posteriors" class="section level3 hasAnchor" number="5.1.5">
<h3><span class="header-section-number">5.1.5</span> Plotting multivariate posteriors<a href="the-many-variables-the-spurious-waffles.html#plotting-multivariate-posteriors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once there are more than one predictor variable in the model, a simple scatterplot with a regression line and confidence intervals will not convey as much information as you would want. McElreath explains three example plots to convey more information about your multivariate models<br />
</p>
<ol style="list-style-type: decimal">
<li><em>Predictor residual plots.</em> These plots will show the outcome against residual predictor values.<br />
</li>
<li><em>Posterior prediction plots.</em> These will show model-based predictions against the observations (data).<br />
</li>
<li><em>Counterfactual plots.</em> These show implied predictions from imaginary experiments. They can allow you to explore causal implications of the model by manipulating variables.<br />
</li>
</ol>
<div id="predictor-residual-plots" class="section level4 hasAnchor" number="5.1.5.1">
<h4><span class="header-section-number">5.1.5.1</span> Predictor residual plots<a href="the-many-variables-the-spurious-waffles.html#predictor-residual-plots" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Looking again at <span class="math inline">\(A \sim M\)</span> (m5.4) above, we can calculate the residual (difference from posterior mean) for each data point</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="the-many-variables-the-spurious-waffles.html#cb42-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">link</span>(m5<span class="fl">.4</span>)</span>
<span id="cb42-2"><a href="the-many-variables-the-spurious-waffles.html#cb42-2" aria-hidden="true" tabindex="-1"></a>mu_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, mean)</span>
<span id="cb42-3"><a href="the-many-variables-the-spurious-waffles.html#cb42-3" aria-hidden="true" tabindex="-1"></a>mu_resid <span class="ot">&lt;-</span> d<span class="sc">$</span>M <span class="sc">-</span> mu_mean</span>
<span id="cb42-4"><a href="the-many-variables-the-spurious-waffles.html#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="the-many-variables-the-spurious-waffles.html#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co"># rough plot (Not in book)</span></span>
<span id="cb42-6"><a href="the-many-variables-the-spurious-waffles.html#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(M <span class="sc">~</span> A, <span class="at">data =</span> d, <span class="at">col =</span> rangi2, <span class="at">xlab =</span> <span class="st">&#39;Median age of marriage (std)&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;Marriage rate (std)&#39;</span>)</span>
<span id="cb42-7"><a href="the-many-variables-the-spurious-waffles.html#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(A_seq, mu.mean, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb42-8"><a href="the-many-variables-the-spurious-waffles.html#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(d<span class="sc">$</span>A)){</span>
<span id="cb42-9"><a href="the-many-variables-the-spurious-waffles.html#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(d<span class="sc">$</span>A[i], d<span class="sc">$</span>M[i], d<span class="sc">$</span>A[i], mu_mean[i] )</span>
<span id="cb42-10"><a href="the-many-variables-the-spurious-waffles.html#cb42-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="_main_files/figure-html/Rcode%205.14-1.png" width="672" /></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="the-many-variables-the-spurious-waffles.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plotted horizontally against Divorce rate</span></span>
<span id="cb43-2"><a href="the-many-variables-the-spurious-waffles.html#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="the-many-variables-the-spurious-waffles.html#cb43-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">cbind</span>(d, mu_resid)</span>
<span id="cb43-4"><a href="the-many-variables-the-spurious-waffles.html#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="the-many-variables-the-spurious-waffles.html#cb43-5" aria-hidden="true" tabindex="-1"></a>m5<span class="fl">.4</span>b <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb43-6"><a href="the-many-variables-the-spurious-waffles.html#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb43-7"><a href="the-many-variables-the-spurious-waffles.html#cb43-7" aria-hidden="true" tabindex="-1"></a>    D <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb43-8"><a href="the-many-variables-the-spurious-waffles.html#cb43-8" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> bMR <span class="sc">*</span> mu_resid,</span>
<span id="cb43-9"><a href="the-many-variables-the-spurious-waffles.html#cb43-9" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb43-10"><a href="the-many-variables-the-spurious-waffles.html#cb43-10" aria-hidden="true" tabindex="-1"></a>    bMR <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb43-11"><a href="the-many-variables-the-spurious-waffles.html#cb43-11" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb43-12"><a href="the-many-variables-the-spurious-waffles.html#cb43-12" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> d</span>
<span id="cb43-13"><a href="the-many-variables-the-spurious-waffles.html#cb43-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-14"><a href="the-many-variables-the-spurious-waffles.html#cb43-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-15"><a href="the-many-variables-the-spurious-waffles.html#cb43-15" aria-hidden="true" tabindex="-1"></a>reside_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fl">1.55</span>, <span class="at">to =</span> <span class="fl">1.8</span>, <span class="at">length.out =</span> <span class="dv">30</span>)</span>
<span id="cb43-16"><a href="the-many-variables-the-spurious-waffles.html#cb43-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-17"><a href="the-many-variables-the-spurious-waffles.html#cb43-17" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">link</span>(m5<span class="fl">.4</span>b, <span class="at">data =</span> <span class="fu">list</span>(<span class="at">mu_resid =</span> reside_seq))</span>
<span id="cb43-18"><a href="the-many-variables-the-spurious-waffles.html#cb43-18" aria-hidden="true" tabindex="-1"></a>mu.mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, mean)</span>
<span id="cb43-19"><a href="the-many-variables-the-spurious-waffles.html#cb43-19" aria-hidden="true" tabindex="-1"></a>mu.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, PI)</span>
<span id="cb43-20"><a href="the-many-variables-the-spurious-waffles.html#cb43-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-21"><a href="the-many-variables-the-spurious-waffles.html#cb43-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-22"><a href="the-many-variables-the-spurious-waffles.html#cb43-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> mu_resid, <span class="at">y =</span> d<span class="sc">$</span>D, <span class="at">xlab =</span> <span class="st">&#39;Marriage rate residuals&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;Divorce rate (std)&#39;</span>,</span>
<span id="cb43-23"><a href="the-many-variables-the-spurious-waffles.html#cb43-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="fu">col.alpha</span>(rangi2, <span class="fl">0.5</span>))</span>
<span id="cb43-24"><a href="the-many-variables-the-spurious-waffles.html#cb43-24" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(reside_seq, mu.mean)</span>
<span id="cb43-25"><a href="the-many-variables-the-spurious-waffles.html#cb43-25" aria-hidden="true" tabindex="-1"></a><span class="fu">shade</span>(mu.PI, reside_seq)</span>
<span id="cb43-26"><a href="the-many-variables-the-spurious-waffles.html#cb43-26" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">&#39;grey50&#39;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb43-27"><a href="the-many-variables-the-spurious-waffles.html#cb43-27" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>( <span class="at">x =</span> <span class="sc">-</span><span class="fl">0.2</span>, <span class="at">y =</span> <span class="dv">2</span>, <span class="at">label =</span> <span class="st">&#39;slower&#39;</span>)</span>
<span id="cb43-28"><a href="the-many-variables-the-spurious-waffles.html#cb43-28" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="fl">0.2</span>, <span class="at">y =</span> <span class="dv">2</span>, <span class="at">label =</span> <span class="st">&#39;faster&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>As we already found from the model, the marriage rate has little to no effect on the divorce rate, no matter how far the observation is from the expected mean.</p>
<p>This process can be repeated for the other predictor as well</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="the-many-variables-the-spurious-waffles.html#cb44-1" aria-hidden="true" tabindex="-1"></a>m5<span class="fl">.4</span>c <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb44-2"><a href="the-many-variables-the-spurious-waffles.html#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb44-3"><a href="the-many-variables-the-spurious-waffles.html#cb44-3" aria-hidden="true" tabindex="-1"></a>    A <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb44-4"><a href="the-many-variables-the-spurious-waffles.html#cb44-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> bMA <span class="sc">*</span> M,</span>
<span id="cb44-5"><a href="the-many-variables-the-spurious-waffles.html#cb44-5" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb44-6"><a href="the-many-variables-the-spurious-waffles.html#cb44-6" aria-hidden="true" tabindex="-1"></a>    bMA <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb44-7"><a href="the-many-variables-the-spurious-waffles.html#cb44-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb44-8"><a href="the-many-variables-the-spurious-waffles.html#cb44-8" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> d</span>
<span id="cb44-9"><a href="the-many-variables-the-spurious-waffles.html#cb44-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-10"><a href="the-many-variables-the-spurious-waffles.html#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="the-many-variables-the-spurious-waffles.html#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="the-many-variables-the-spurious-waffles.html#cb44-12" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">link</span>(m5<span class="fl">.4</span>c)</span>
<span id="cb44-13"><a href="the-many-variables-the-spurious-waffles.html#cb44-13" aria-hidden="true" tabindex="-1"></a>mu_mean2 <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, mean)</span>
<span id="cb44-14"><a href="the-many-variables-the-spurious-waffles.html#cb44-14" aria-hidden="true" tabindex="-1"></a>mu_resid2 <span class="ot">&lt;-</span> d<span class="sc">$</span>A <span class="sc">-</span> mu_mean2</span>
<span id="cb44-15"><a href="the-many-variables-the-spurious-waffles.html#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="the-many-variables-the-spurious-waffles.html#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate percentiles</span></span>
<span id="cb44-17"><a href="the-many-variables-the-spurious-waffles.html#cb44-17" aria-hidden="true" tabindex="-1"></a>M_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fl">1.76</span>, <span class="at">to =</span> <span class="fl">2.85</span>, <span class="at">length.out =</span> <span class="dv">30</span>)</span>
<span id="cb44-18"><a href="the-many-variables-the-spurious-waffles.html#cb44-18" aria-hidden="true" tabindex="-1"></a>mu2 <span class="ot">&lt;-</span> <span class="fu">link</span>(m5<span class="fl">.4</span>c, <span class="at">data =</span> <span class="fu">list</span>(<span class="at">M =</span> M_seq))</span>
<span id="cb44-19"><a href="the-many-variables-the-spurious-waffles.html#cb44-19" aria-hidden="true" tabindex="-1"></a>mu.mean2 <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu2, <span class="dv">2</span>, mean)</span>
<span id="cb44-20"><a href="the-many-variables-the-spurious-waffles.html#cb44-20" aria-hidden="true" tabindex="-1"></a>mu.PI2 <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu2, <span class="dv">2</span>, PI)</span>
<span id="cb44-21"><a href="the-many-variables-the-spurious-waffles.html#cb44-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-22"><a href="the-many-variables-the-spurious-waffles.html#cb44-22" aria-hidden="true" tabindex="-1"></a><span class="co">#plot</span></span>
<span id="cb44-23"><a href="the-many-variables-the-spurious-waffles.html#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(A <span class="sc">~</span> M, <span class="at">data =</span> d, <span class="at">col =</span> rangi2, <span class="at">xlab =</span> <span class="st">&#39;Marriage rate (std)&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;Median age of marriage (std)&#39;</span>)</span>
<span id="cb44-24"><a href="the-many-variables-the-spurious-waffles.html#cb44-24" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(M_seq, mu.mean2, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb44-25"><a href="the-many-variables-the-spurious-waffles.html#cb44-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(d<span class="sc">$</span>M)){</span>
<span id="cb44-26"><a href="the-many-variables-the-spurious-waffles.html#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(d<span class="sc">$</span>M[i], d<span class="sc">$</span>A[i], d<span class="sc">$</span>M[i], mu_mean2[i] )</span>
<span id="cb44-27"><a href="the-many-variables-the-spurious-waffles.html#cb44-27" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="the-many-variables-the-spurious-waffles.html#cb45-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">cbind</span>(d, mu_resid2)</span>
<span id="cb45-2"><a href="the-many-variables-the-spurious-waffles.html#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="the-many-variables-the-spurious-waffles.html#cb45-3" aria-hidden="true" tabindex="-1"></a>m5<span class="fl">.4</span>d <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb45-4"><a href="the-many-variables-the-spurious-waffles.html#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb45-5"><a href="the-many-variables-the-spurious-waffles.html#cb45-5" aria-hidden="true" tabindex="-1"></a>    D <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb45-6"><a href="the-many-variables-the-spurious-waffles.html#cb45-6" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> bMR <span class="sc">*</span> mu_resid2,</span>
<span id="cb45-7"><a href="the-many-variables-the-spurious-waffles.html#cb45-7" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb45-8"><a href="the-many-variables-the-spurious-waffles.html#cb45-8" aria-hidden="true" tabindex="-1"></a>    bMR <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb45-9"><a href="the-many-variables-the-spurious-waffles.html#cb45-9" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb45-10"><a href="the-many-variables-the-spurious-waffles.html#cb45-10" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> d</span>
<span id="cb45-11"><a href="the-many-variables-the-spurious-waffles.html#cb45-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-12"><a href="the-many-variables-the-spurious-waffles.html#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="the-many-variables-the-spurious-waffles.html#cb45-13" aria-hidden="true" tabindex="-1"></a>reside_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fl">1.3</span>, <span class="at">to =</span> <span class="fl">2.5</span>, <span class="at">length.out =</span> <span class="dv">30</span>)</span>
<span id="cb45-14"><a href="the-many-variables-the-spurious-waffles.html#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="the-many-variables-the-spurious-waffles.html#cb45-15" aria-hidden="true" tabindex="-1"></a>mu2 <span class="ot">&lt;-</span> <span class="fu">link</span>(m5<span class="fl">.4</span>d, <span class="at">data =</span> <span class="fu">list</span>(<span class="at">mu_resid2 =</span> reside_seq))</span>
<span id="cb45-16"><a href="the-many-variables-the-spurious-waffles.html#cb45-16" aria-hidden="true" tabindex="-1"></a>mu.mean2 <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu2, <span class="dv">2</span>, mean)</span>
<span id="cb45-17"><a href="the-many-variables-the-spurious-waffles.html#cb45-17" aria-hidden="true" tabindex="-1"></a>mu.PI2 <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu2, <span class="dv">2</span>, PI)</span>
<span id="cb45-18"><a href="the-many-variables-the-spurious-waffles.html#cb45-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-19"><a href="the-many-variables-the-spurious-waffles.html#cb45-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-20"><a href="the-many-variables-the-spurious-waffles.html#cb45-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> mu_resid2, <span class="at">y =</span> d<span class="sc">$</span>D, <span class="at">xlab =</span> <span class="st">&#39;Median age residuals&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;Divorce rate (std)&#39;</span>,</span>
<span id="cb45-21"><a href="the-many-variables-the-spurious-waffles.html#cb45-21" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="fu">col.alpha</span>(rangi2, <span class="fl">0.5</span>))</span>
<span id="cb45-22"><a href="the-many-variables-the-spurious-waffles.html#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(reside_seq, mu.mean2)</span>
<span id="cb45-23"><a href="the-many-variables-the-spurious-waffles.html#cb45-23" aria-hidden="true" tabindex="-1"></a><span class="fu">shade</span>(mu.PI2, reside_seq)</span>
<span id="cb45-24"><a href="the-many-variables-the-spurious-waffles.html#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">&#39;grey50&#39;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb45-25"><a href="the-many-variables-the-spurious-waffles.html#cb45-25" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>( <span class="at">x =</span> <span class="sc">-</span><span class="fl">0.25</span>, <span class="at">y =</span> <span class="dv">2</span>, <span class="at">label =</span> <span class="st">&#39;younger&#39;</span>)</span>
<span id="cb45-26"><a href="the-many-variables-the-spurious-waffles.html#cb45-26" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="fl">0.2</span>, <span class="at">y =</span> <span class="dv">2</span>, <span class="at">label =</span> <span class="st">&#39;older&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>And just as the model tells us, states that have younger than the expected average age of marriage have higher divorce rates than states that have older than expected age of marriage.<br />
</p>
</div>
<div id="posterior-prediction-plots" class="section level4 hasAnchor" number="5.1.5.2">
<h4><span class="header-section-number">5.1.5.2</span> Posterior prediction plots<a href="the-many-variables-the-spurious-waffles.html#posterior-prediction-plots" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Comparing model predictions against the observations can serve a couple purposes<br />
</p>
<ol style="list-style-type: decimal">
<li>Checking to see that the model correctly approximated the posterior<br />
</li>
<li>Checking to see how the model fails and if it should even be retained<br />
</li>
</ol>
<p>Here’s how we could simulate predictions</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="the-many-variables-the-spurious-waffles.html#cb46-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">link</span>(m5<span class="fl">.3</span>) <span class="co">#our multivariate model of divorce rate</span></span>
<span id="cb46-2"><a href="the-many-variables-the-spurious-waffles.html#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="the-many-variables-the-spurious-waffles.html#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co">#summarize samples</span></span>
<span id="cb46-4"><a href="the-many-variables-the-spurious-waffles.html#cb46-4" aria-hidden="true" tabindex="-1"></a>mu_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, mean)</span>
<span id="cb46-5"><a href="the-many-variables-the-spurious-waffles.html#cb46-5" aria-hidden="true" tabindex="-1"></a>mu_PI <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, PI)</span>
<span id="cb46-6"><a href="the-many-variables-the-spurious-waffles.html#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="the-many-variables-the-spurious-waffles.html#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co">#simulate observations</span></span>
<span id="cb46-8"><a href="the-many-variables-the-spurious-waffles.html#cb46-8" aria-hidden="true" tabindex="-1"></a>D_sim <span class="ot">&lt;-</span> <span class="fu">sim</span>(m5<span class="fl">.3</span>, <span class="at">n =</span> <span class="fl">1e4</span>)</span>
<span id="cb46-9"><a href="the-many-variables-the-spurious-waffles.html#cb46-9" aria-hidden="true" tabindex="-1"></a>D_PI <span class="ot">&lt;-</span> <span class="fu">apply</span>(D_sim, <span class="dv">2</span>, PI)</span></code></pre></div>
<p>and then plot the results</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="the-many-variables-the-spurious-waffles.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mu_mean <span class="sc">~</span> d<span class="sc">$</span>D, <span class="at">col =</span> rangi2, <span class="at">ylim =</span> <span class="fu">range</span>(mu_PI), </span>
<span id="cb47-2"><a href="the-many-variables-the-spurious-waffles.html#cb47-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&#39;Observed divorce&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;Predicted divorce&#39;</span>)</span>
<span id="cb47-3"><a href="the-many-variables-the-spurious-waffles.html#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb47-4"><a href="the-many-variables-the-spurious-waffles.html#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(d)){</span>
<span id="cb47-5"><a href="the-many-variables-the-spurious-waffles.html#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">rep</span>(d<span class="sc">$</span>D[i],<span class="dv">2</span>), mu_PI[,i], <span class="at">col =</span> rangi2)</span>
<span id="cb47-6"><a href="the-many-variables-the-spurious-waffles.html#cb47-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="_main_files/figure-html/Rcode%205.16-1.png" width="672" /></p>
<p>Somewhat unsurprisingly, the model is bad with extreme values (-2, 2), and does pretty well near the means.</p>
</div>
<div id="counterfactual-plots" class="section level4 hasAnchor" number="5.1.5.3">
<h4><span class="header-section-number">5.1.5.3</span> Counterfactual plots<a href="the-many-variables-the-spurious-waffles.html#counterfactual-plots" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Here McElreath makes use of the term counterfactual in the sense of some computation that that makes use of the casual model. This is done by manipulating variables to see how the outcome would change.</p>
<p>The general recipe would be<br />
1. pick a variable to manipulate<br />
2. define a range of values for the manipulation<br />
3. for each value of the manipulated variable, and for each sample in the posterior, use the causal model to simulate the other variables and outcome variable.<br />
</p>
<p>For this example we will be looking at the first <strong>DAG</strong> we came up with with the three arrows
<img src="_main_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Let’s create the model for this example</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="the-many-variables-the-spurious-waffles.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;WaffleDivorce&quot;</span>)</span>
<span id="cb48-2"><a href="the-many-variables-the-spurious-waffles.html#cb48-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb48-3"><a href="the-many-variables-the-spurious-waffles.html#cb48-3" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>A <span class="ot">&lt;-</span> <span class="fu">standardize</span>(WaffleDivorce<span class="sc">$</span>MedianAgeMarriage)</span>
<span id="cb48-4"><a href="the-many-variables-the-spurious-waffles.html#cb48-4" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>D <span class="ot">&lt;-</span> <span class="fu">standardize</span>(WaffleDivorce<span class="sc">$</span>Divorce)</span>
<span id="cb48-5"><a href="the-many-variables-the-spurious-waffles.html#cb48-5" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>M <span class="ot">&lt;-</span> <span class="fu">standardize</span>(WaffleDivorce<span class="sc">$</span>Marriage)</span>
<span id="cb48-6"><a href="the-many-variables-the-spurious-waffles.html#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="the-many-variables-the-spurious-waffles.html#cb48-7" aria-hidden="true" tabindex="-1"></a>m5<span class="fl">.3</span>_A <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb48-8"><a href="the-many-variables-the-spurious-waffles.html#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb48-9"><a href="the-many-variables-the-spurious-waffles.html#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="do">## A -&gt; D &lt;- M</span></span>
<span id="cb48-10"><a href="the-many-variables-the-spurious-waffles.html#cb48-10" aria-hidden="true" tabindex="-1"></a>    D <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb48-11"><a href="the-many-variables-the-spurious-waffles.html#cb48-11" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> bM<span class="sc">*</span>M <span class="sc">+</span> bA<span class="sc">*</span>A,</span>
<span id="cb48-12"><a href="the-many-variables-the-spurious-waffles.html#cb48-12" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),</span>
<span id="cb48-13"><a href="the-many-variables-the-spurious-waffles.html#cb48-13" aria-hidden="true" tabindex="-1"></a>    bM <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb48-14"><a href="the-many-variables-the-spurious-waffles.html#cb48-14" aria-hidden="true" tabindex="-1"></a>    bA <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb48-15"><a href="the-many-variables-the-spurious-waffles.html#cb48-15" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb48-16"><a href="the-many-variables-the-spurious-waffles.html#cb48-16" aria-hidden="true" tabindex="-1"></a>    <span class="do">## A -&gt; M</span></span>
<span id="cb48-17"><a href="the-many-variables-the-spurious-waffles.html#cb48-17" aria-hidden="true" tabindex="-1"></a>    M <span class="sc">~</span> <span class="fu">dnorm</span>(mu_M, sigma_M),</span>
<span id="cb48-18"><a href="the-many-variables-the-spurious-waffles.html#cb48-18" aria-hidden="true" tabindex="-1"></a>    mu_M <span class="ot">&lt;-</span> aM <span class="sc">+</span> bAM<span class="sc">*</span>A,</span>
<span id="cb48-19"><a href="the-many-variables-the-spurious-waffles.html#cb48-19" aria-hidden="true" tabindex="-1"></a>    aM <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb48-20"><a href="the-many-variables-the-spurious-waffles.html#cb48-20" aria-hidden="true" tabindex="-1"></a>    bAM <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb48-21"><a href="the-many-variables-the-spurious-waffles.html#cb48-21" aria-hidden="true" tabindex="-1"></a>    sigma_M <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb48-22"><a href="the-many-variables-the-spurious-waffles.html#cb48-22" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> d</span>
<span id="cb48-23"><a href="the-many-variables-the-spurious-waffles.html#cb48-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-24"><a href="the-many-variables-the-spurious-waffles.html#cb48-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-25"><a href="the-many-variables-the-spurious-waffles.html#cb48-25" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m5<span class="fl">.3</span>_A)</span></code></pre></div>
<pre><code>##                  mean         sd       5.5%      94.5%
## a       -0.0000194729 0.09707615 -0.1551659  0.1551270
## bM      -0.0655282376 0.15077177 -0.3064906  0.1754342
## bA      -0.6135574871 0.15098333 -0.8548580 -0.3722570
## sigma    0.7851193004 0.07784372  0.6607100  0.9095286
## aM      -0.0000642742 0.08825440 -0.1411119  0.1409833
## bAM     -0.5783793520 0.09200708 -0.7254244 -0.4313343
## sigma_M  0.6954216151 0.07116903  0.5816798  0.8091635</code></pre>
<p>Now we will define our value range</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="the-many-variables-the-spurious-waffles.html#cb50-1" aria-hidden="true" tabindex="-1"></a>A_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">30</span>)</span></code></pre></div>
<p>Now we can simulate observations from this range</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="the-many-variables-the-spurious-waffles.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#prep data</span></span>
<span id="cb51-2"><a href="the-many-variables-the-spurious-waffles.html#cb51-2" aria-hidden="true" tabindex="-1"></a>sim_dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">A =</span> A_seq)</span>
<span id="cb51-3"><a href="the-many-variables-the-spurious-waffles.html#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="the-many-variables-the-spurious-waffles.html#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co">#simulate M and then D, using A_seq</span></span>
<span id="cb51-5"><a href="the-many-variables-the-spurious-waffles.html#cb51-5" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">sim</span>(m5<span class="fl">.3</span>_A, <span class="at">data =</span> sim_dat, <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">&#39;M&#39;</span>, <span class="st">&#39;D&#39;</span>))</span></code></pre></div>
<p>and plot the predictions</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="the-many-variables-the-spurious-waffles.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sim_dat<span class="sc">$</span>A, <span class="fu">colMeans</span>(s<span class="sc">$</span>D), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>), <span class="at">type =</span> <span class="st">&#39;l&#39;</span>,</span>
<span id="cb52-2"><a href="the-many-variables-the-spurious-waffles.html#cb52-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&#39;manipulated A&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;counterfactual D&#39;</span>)</span>
<span id="cb52-3"><a href="the-many-variables-the-spurious-waffles.html#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">shade</span>(<span class="fu">apply</span>(s<span class="sc">$</span>D, <span class="dv">2</span>, PI), sim_dat<span class="sc">$</span>A)</span>
<span id="cb52-4"><a href="the-many-variables-the-spurious-waffles.html#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&quot;total counterfactual effect of A on D&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/Rcode%205.22-1.png" width="672" /></p>
<p>This plot above shows the trend in D following both paths <span class="math inline">\(A \rightarrow D\)</span> and <span class="math inline">\(A \rightarrow M \rightarrow D\)</span></p>
<p>We can also produce the effect of <span class="math inline">\(A \rightarrow M\)</span></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="the-many-variables-the-spurious-waffles.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sim_dat<span class="sc">$</span>A, <span class="fu">colMeans</span>(s<span class="sc">$</span>M), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>), <span class="at">type =</span> <span class="st">&#39;l&#39;</span>,</span>
<span id="cb53-2"><a href="the-many-variables-the-spurious-waffles.html#cb53-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&#39;manipulated A&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;counterfactual M&#39;</span>)</span>
<span id="cb53-3"><a href="the-many-variables-the-spurious-waffles.html#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">shade</span>(<span class="fu">apply</span>(s<span class="sc">$</span>M, <span class="dv">2</span>, PI), sim_dat<span class="sc">$</span>A)</span>
<span id="cb53-4"><a href="the-many-variables-the-spurious-waffles.html#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&quot;Counterfactual effect of A on M&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Let’s raise the median age of marriage from 20 to 30 and see the change in Divorce rate (in std dev units)</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="the-many-variables-the-spurious-waffles.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#new data with mean 26.1 and std dev 1.24</span></span>
<span id="cb54-2"><a href="the-many-variables-the-spurious-waffles.html#cb54-2" aria-hidden="true" tabindex="-1"></a>sim2_dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">A =</span> (<span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">30</span>)<span class="sc">-</span><span class="fl">26.1</span>)<span class="sc">/</span><span class="fl">1.24</span>)</span>
<span id="cb54-3"><a href="the-many-variables-the-spurious-waffles.html#cb54-3" aria-hidden="true" tabindex="-1"></a>s2 <span class="ot">&lt;-</span> <span class="fu">sim</span>(m5<span class="fl">.3</span>_A, <span class="at">data =</span> sim2_dat, <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">&#39;M&#39;</span>,<span class="st">&#39;D&#39;</span>))</span>
<span id="cb54-4"><a href="the-many-variables-the-spurious-waffles.html#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(s2<span class="sc">$</span>D[,<span class="dv">2</span>] <span class="sc">-</span> s2<span class="sc">$</span>D[,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] -4.643447</code></pre>
<p>Reducing divorce by 4.5 standard deviations is probably unlikely</p>
<p>If we wanted to manipulate <span class="math inline">\(M\)</span> instead of <span class="math inline">\(A\)</span> we would have to consider a new <strong>DAG</strong> where <span class="math inline">\(A\)</span> can’t influence <span class="math inline">\(M\)</span> because we are controlling it.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="the-many-variables-the-spurious-waffles.html#cb56-1" aria-hidden="true" tabindex="-1"></a>dag5<span class="fl">.3</span> <span class="ot">&lt;-</span><span class="fu">dagitty</span>(<span class="st">&quot;dag{A-&gt;D;M-&gt;D}&quot;</span>)</span>
<span id="cb56-2"><a href="the-many-variables-the-spurious-waffles.html#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(dag5<span class="fl">.3</span>) <span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="at">A=</span><span class="dv">0</span>,<span class="at">D=</span><span class="dv">1</span>,<span class="at">M=</span><span class="dv">2</span>),<span class="at">y=</span><span class="fu">c</span>(<span class="at">A=</span><span class="dv">0</span>,<span class="at">D=</span><span class="dv">1</span>,<span class="at">M=</span><span class="dv">0</span>))</span>
<span id="cb56-3"><a href="the-many-variables-the-spurious-waffles.html#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">drawdag</span>(dag5<span class="fl">.3</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Let’s set <span class="math inline">\(A\)</span> to equal 0 and just worry about <span class="math inline">\(M\)</span> changing</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="the-many-variables-the-spurious-waffles.html#cb57-1" aria-hidden="true" tabindex="-1"></a>sim_dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">M =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">30</span>), <span class="at">A =</span> <span class="dv">0</span>)</span>
<span id="cb57-2"><a href="the-many-variables-the-spurious-waffles.html#cb57-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">sim</span>(m5<span class="fl">.3</span>_A, <span class="at">data =</span> sim_dat, <span class="at">vars =</span> <span class="st">&#39;D&#39;</span>)</span>
<span id="cb57-3"><a href="the-many-variables-the-spurious-waffles.html#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="the-many-variables-the-spurious-waffles.html#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sim_dat<span class="sc">$</span>M, <span class="fu">colMeans</span>(s), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>), <span class="at">type =</span> <span class="st">&#39;l&#39;</span>,</span>
<span id="cb57-5"><a href="the-many-variables-the-spurious-waffles.html#cb57-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&#39;manipulated M&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;counterfactual D&#39;</span>)</span>
<span id="cb57-6"><a href="the-many-variables-the-spurious-waffles.html#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="fu">shade</span>(<span class="fu">apply</span>(s, <span class="dv">2</span>, PI), sim_dat<span class="sc">$</span>M)</span>
<span id="cb57-7"><a href="the-many-variables-the-spurious-waffles.html#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&quot;Total counterfactual effect of M on D&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/Rcode%205.24-1.png" width="672" /></p>
<p>You can see from this counterfactual that any value of <span class="math inline">\(M\)</span> has very little effect on <span class="math inline">\(D\)</span>. We already expected this because we knew there was a weak effect in the model (<code>bM</code>)</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="the-many-variables-the-spurious-waffles.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftab</span>(m5<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>##       m5.3   
## a           0
## bM      -0.07
## bA      -0.61
## sigma    0.79
## nobs       50</code></pre>
</div>
<div id="simulate-counterfactuals-by-hand" class="section level4 hasAnchor" number="5.1.5.4">
<h4><span class="header-section-number">5.1.5.4</span> Simulate counterfactuals by hand<a href="the-many-variables-the-spurious-waffles.html#simulate-counterfactuals-by-hand" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Let’s manipulate <span class="math inline">\(A\)</span> again but simulate by hand</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="the-many-variables-the-spurious-waffles.html#cb60-1" aria-hidden="true" tabindex="-1"></a>A_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">30</span>)</span></code></pre></div>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="the-many-variables-the-spurious-waffles.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">#grab samples from posterior</span></span>
<span id="cb61-2"><a href="the-many-variables-the-spurious-waffles.html#cb61-2" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m5<span class="fl">.3</span>_A)</span>
<span id="cb61-3"><a href="the-many-variables-the-spurious-waffles.html#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co"># use sapply to estimate M from values in post and A_seq</span></span>
<span id="cb61-4"><a href="the-many-variables-the-spurious-waffles.html#cb61-4" aria-hidden="true" tabindex="-1"></a>M_sim <span class="ot">&lt;-</span> <span class="fu">with</span>(post, <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>, <span class="cf">function</span>(i) <span class="fu">rnorm</span>(<span class="fl">1e3</span>, aM <span class="sc">+</span> bAM <span class="sc">*</span> A_seq[i], sigma_M)))</span></code></pre></div>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="the-many-variables-the-spurious-waffles.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use sapply to estimate D from values in post, M_sim, and A_seq</span></span>
<span id="cb62-2"><a href="the-many-variables-the-spurious-waffles.html#cb62-2" aria-hidden="true" tabindex="-1"></a>D_sim <span class="ot">&lt;-</span> <span class="fu">with</span>(post, <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>, </span>
<span id="cb62-3"><a href="the-many-variables-the-spurious-waffles.html#cb62-3" aria-hidden="true" tabindex="-1"></a>                           <span class="cf">function</span>(i) <span class="fu">rnorm</span>(<span class="fl">1e3</span>, a <span class="sc">+</span> bA<span class="sc">*</span>A_seq[i] <span class="sc">+</span> bM<span class="sc">*</span>M_sim[,i] , sigma_M)))</span></code></pre></div>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="the-many-variables-the-spurious-waffles.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot A_seq against D_sim colMeans</span></span>
<span id="cb63-2"><a href="the-many-variables-the-spurious-waffles.html#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(A_seq, <span class="fu">colMeans</span>(D_sim), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>), <span class="at">type =</span> <span class="st">&#39;l&#39;</span>,</span>
<span id="cb63-3"><a href="the-many-variables-the-spurious-waffles.html#cb63-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&#39;manipulated A&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;counterfactual D&#39;</span>)</span>
<span id="cb63-4"><a href="the-many-variables-the-spurious-waffles.html#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">shade</span>(<span class="fu">apply</span>(D_sim, <span class="dv">2</span>, PI), A_seq)</span>
<span id="cb63-5"><a href="the-many-variables-the-spurious-waffles.html#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&quot;total counterfactual effect of A on D&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="masked-relationship" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Masked relationship<a href="the-many-variables-the-spurious-waffles.html#masked-relationship" class="anchor-section" aria-label="Anchor link to header"></a></h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="geocentric-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="the-haunted-dag-the-casual-terror.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/04-citations.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
